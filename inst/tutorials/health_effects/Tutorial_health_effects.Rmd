---
title: "Tutorial health effects"
output: 
  learnr::tutorial:
    progressive: true
    allow_skip: true
runtime: shiny_prerendered
description: >
  Get acquainted to measuring and
  valuing quality of life.
---

```{r setup, include = FALSE}
require(learnr, quietly = TRUE)
require(knitr, quietly = TRUE)
require(ggplot2, quietly = TRUE)
require(shiny, quietly = TRUE)
require(dplyr, quietly = TRUE)
require(diagram, quietly = TRUE)
require(magrittr, quietly = TRUE)
require(tidyr, quietly = TRUE)

knitr::opts_chunk$set(echo = FALSE)

NL_tariff <- ### TO FILL IN!

#### Function SF-36 ----
calculate_sf_36 <- function(v_sf_36) {
  v_sf_36_recoded <- c(5 - v_sf_36[1],
                       5 - v_sf_36[2],
                       v_sf_36[3:19] - 1,
                       5 - v_sf_36[20],
                       6 - v_sf_36[21],
                       5 - v_sf_36[22],
                       6 - v_sf_36[23],
                       v_sf_36[24:25] - 1,
                       6 - v_sf_36[26:27],
                       v_sf_36[28:29] - 1,
                       6 - v_sf_36[30],
                       v_sf_36[31:33] - 1,
                       5 - v_sf_36[34],
                       v_sf_36[35] - 1,
                       5 - v_sf_36[36]
  )
  v_sf_36_transform <- c(v_sf_36_recoded[1] * 25,
                         v_sf_36_recoded[2] * 25,
                         v_sf_36_recoded[3:12] * 50,
                         v_sf_36_recoded[13:19] * 100,
                         v_sf_36_recoded[20] * 25,
                         v_sf_36_recoded[21] * 20,
                         v_sf_36_recoded[22] * 25,
                         v_sf_36_recoded[23:31] * 20,
                         v_sf_36_recoded[32:36] * 25
                         )
  
  df_plot <- data.frame(cbind(Group = c("Respondent", "Migraine", "Control"),
                              PF = c(sum(v_sf_36_transform[3:12])/10, 84.8, 86.1),
                              RP = c(sum(v_sf_36_transform[13:16])/4, 63.3, 76.6),
                              RE = c(sum(v_sf_36_transform[17:19])/3, 75.1, 81.2),
                              VT = c(sum(v_sf_36_transform[c(23, 27, 29, 31)])/4, 61.5, 68),
                              MH = c(sum(v_sf_36_transform[c(24, 25, 26, 28, 30)])/5, 72.2, 76.8),
                              SF = c(sum(v_sf_36_transform[c(20, 32)])/2, 76.6, 84.7),
                              BP = c(sum(v_sf_36_transform[c(21, 22)])/2, 69.4, 81.6),
                              GH = c(sum(v_sf_36_transform[c(1, 33, 34, 35, 36)])/5, 66.4, 72)
                              )
  )
  
  
  df_plot <- df_plot %>% 
    tidyr::pivot_longer(c(PF, RP, RE, VT, MH, SF, BP, GH), names_to = "Domain", values_to = "Score")
  
  df_plot$Score <- as.numeric(as.character(df_plot$Score))
  
  return(df_plot)
  
}

#### Function EQ-5D-5L ----
estimate_utility <- function(mo = 1, sc = 1, ua = 1, pd = 1, ad = 1, tbl_decrements = NL_tariff){
  ##mo = mobility level (1 to 5)
  ##sc = self-care level (1 to 5)
  ##ua = usual activities level (1 to 5)
  ##pd = pain/ discomfort level (1 to 5)
  ##ad = anxiety/ discomfort level (1 to 5)
  ##tbl_decrements = table with decrements, with 2 columns (Levels and Decrements), order by category and levels
  
  res <- numeric() # object to store result
  v_levels <- c(mo, sc, ua, pd, ad) # create vector of levels
  v_possible_levels <- c(1:5)
 
  try(if(all(v_levels %in% v_possible_levels) == FALSE) stop ("levels different than 1 to 5"))

  if(v_levels[1] == 1 &
     v_levels[2] == 1 &
     v_levels[3] == 1 &
     v_levels[4] == 1 &
     v_levels[5] == 1) {
    
    res <- tbl_decrements[which(tbl_decrements$Levels == "Constant"), "Decrements"]
    
  } else{
    
    constant <- tbl_decrements[which(tbl_decrements$Levels == "Constant"), "Decrements"] # Constant when deviating from full health
    utility <- as.numeric(as.character(constant)) + 
      ifelse(as.numeric(as.character(v_levels[1])) == 1, as.numeric(as.character("0")), as.numeric(as.character(tbl_decrements[which(tbl_decrements$Levels == paste0("mo", v_levels[1])), "Decrements"]))) +
      ifelse(as.numeric(as.character(v_levels[2])) == 1, as.numeric(as.character("0")), as.numeric(as.character(tbl_decrements[which(tbl_decrements$Levels == paste0("sc", v_levels[2])), "Decrements"]))) +
      ifelse(as.numeric(as.character(v_levels[3])) == 1, as.numeric(as.character("0")), as.numeric(as.character(tbl_decrements[which(tbl_decrements$Levels == paste0("ua", v_levels[3])), "Decrements"]))) +
      ifelse(as.numeric(as.character(v_levels[4])) == 1, as.numeric(as.character("0")), as.numeric(as.character(tbl_decrements[which(tbl_decrements$Levels == paste0("pd", v_levels[4])), "Decrements"]))) +
      ifelse(as.numeric(as.character(v_levels[5])) == 1, as.numeric(as.character("0")), as.numeric(as.character(tbl_decrements[which(tbl_decrements$Levels == paste0("ad", v_levels[5])), "Decrements"]))) # apply decrements
    
    res <- utility
    }
  
  return(res)
}
```

## Instructions

### Before starting
1. Watch the video explaining how to measure and value quality of life (to do so, you probably need to open open the tutorial in your browser using the 'Open in Browser' button on the upper left side of the screen.  
![](){width="70%"}
Link to the video: .  

### Aims and instructions
The overall aim of this assignment is to get you acquainted with measuring and valuing quality of life using different instruments.  
**OF NOTE**: the solutions which are provided are one way to perform the calculations, you can obtain the same results using other fomula's. The last 'Hint' is always the solution of the assignment. Soultions can be copy/paste in the chunk as shown in the figures below. Once you have completed a code chunk, you can run it by pushing the 'Run code' button on the upper-right side of the chunk.  


```{r, fig.align = 'center', out.width = "70%", echo = F}
knitr::include_graphics("Tutorial_health_effects_files/images/Image_hint.png")
```

```{r, fig.align = 'center', out.width = "70%", echo = F}
knitr::include_graphics("Tutorial_health_effects_files/images/Image_solution.png")
```

[Link to figures](https://education.rstudio.com/blog/2020/05/learnr-for-remote/)

## SF-36
In this assignment you will experience what it is like to fill out the SF-36 Health Survey, a descriptive health-related quality of life instrument. You will start by filling in the SF-36 questionnaire. Subsequently you will enter your individual responses using the button below. These answers will automatically be rescored in the 8 sub-scales of the SF-36. Below a table and a graph will be drawn with your scores ('Respondentâ€™). In these, the scores of a group of patients with migraine and a healthy control group are also displayed for comparison purposes.  
Instructions for completing the questionnaire: Please answer every question. Some questions may look like others, but each one is different. Please take the time to read and answer each question carefully by selecting in the description that best represents your health status.  
Your results are plotted in the graph below, in comparison with the results of a group of migraine patients (N = 340) and a control group of healthy individuals (N = 467).
```{r sf-36_shiny}
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "1. In general, would you say your health is:"),
    radioButtons(inputId = "it_1",
                 label = NULL,
                 choices = list("Excellent" = 1, 
                                "Very good" = 2, 
                                "Good" = 3,
                                "Fair" = 4,
                                "Poor" = 5),
                 selected = 1),
    width = "350px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "2. Compared to one year ago, how would you rate your health in general now?"),
    radioButtons(inputId = "it_2",
                 label = NULL,
                 choices = list("Much better now than a year ago" = 1, 
                                "Somewhat better now than a year ago" = 2, 
                                "About the same as one year ago" = 3,
                                "Somewhat worse now than one year ago" = 4,
                                "Much worse now than one year ago" = 5),
                 selected = 1),
    width = "350px")
tags$hr()
h4("3. The following items are about activities you might do during a typical day. Does your health now limit you in these activities? If so, how much?")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "3.a. Vigorous activities, such as running, lifting heavy objects, participating in strenuous sports."),
    radioButtons(inputId = "it_3a",
             label = NULL,
             choices = list("Yes, limited a lot." = 1, 
                            "Yes, limited a little." = 2, 
                            "No, not limited at all." = 3),
             selected = 3),
    width = "350px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "3.b. Moderate activities, such as moving a table, pushing a vacuum cleaner, bowling, or playing golf?"),
    radioButtons(inputId = "it_3b",
             label = NULL,
             choices = list("Yes, limited a lot." = 1, 
                            "Yes, limited a little." = 2, 
                            "No, not limited at all." = 3),
             selected = 3),
    width = "350px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "3.c. Lifting or carrying groceries."),
    radioButtons(inputId = "it_3c",
             label = NULL,
             choices = list("Yes, limited a lot." = 1, 
                            "Yes, limited a little." = 2, 
                            "No, not limited at all." = 3),
             selected = 3),
    width = "350px"
)
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "3.d. Climbing several flights of stairs."),
    radioButtons(inputId = "it_3d",
             label = NULL,
             choices = list("Yes, limited a lot." = 1, 
                            "Yes, limited a little." = 2, 
                            "No, not limited at all." = 3),
             selected = 3),
    width = "350px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "3.e. Climbing one flight of stairs."),
    radioButtons(inputId = "it_3e",
             label = NULL,
             choices = list("Yes, limited a lot." = 1, 
                            "Yes, limited a little." = 2, 
                            "No, not limited at all." = 3),
             selected = 3),
    width = "350px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "3.f. Bending, kneeling or stooping."),
    radioButtons(inputId = "it_3f",
             label = NULL,
             choices = list("Yes, limited a lot." = 1, 
                            "Yes, limited a little." = 2, 
                            "No, not limited at all." = 3),
             selected = 3),
    width = "350px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "3.g. Walking more than one mile."),
    radioButtons(inputId = "it_3g",
             label = NULL,
             choices = list("Yes, limited a lot." = 1, 
                            "Yes, limited a little." = 2, 
                            "No, not limited at all." = 3),
             selected = 3),
    width = "350px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "3.h. Walking several blocks."),
    radioButtons(inputId = "it_3h",
             label = NULL,
             choices = list("Yes, limited a lot." = 1, 
                            "Yes, limited a little." = 2, 
                            "No, not limited at all." = 3),
             selected = 3),
    width = "350px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "3.i. Walking one block."),
    radioButtons(inputId = "it_3i",
             label = NULL,
             choices = list("Yes, limited a lot." = 1, 
                            "Yes, limited a little." = 2, 
                            "No, not limited at all." = 3),
             selected = 3),
    width = "350px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "3.j. Bathing or dressing yourself."),
    radioButtons(inputId = "it_3j",
                 label = NULL,
                 choices = list("Yes, limited a lot." = 1, 
                                "Yes, limited a little." = 2, 
                                "No, not limited at all." = 3),
                 selected = 3),
    width = "350px")
tags$hr()
h4("4. During the past 4 weeks, have you had any of the following problems with your work or other regular daily activities as a result of your physical health?")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "4.a. Cut down the amount of time you spent on work or other activities?"),
    radioButtons(inputId = "it_4a",
                 label = NULL,
                 choices = list("Yes" = 1, 
                                "No" = 2),
                 selected = 2),
    width = "250px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "4.b. Accomplished less than you would like?"),
    radioButtons(inputId = "it_4b",
                 label = NULL,
                 choices = list("Yes" = 1, 
                                "No" = 2),
                 selected = 2),
    width = "250px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "4.c. Were limited in the kind of work or other activities"),
    radioButtons(inputId = "it_4c",
                 label = NULL,
                 choices = list("Yes" = 1, 
                                "No" = 2),
                 selected = 2),
    width = "250px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "4.d. Had difficulty performing the work or other activities",
             tags$br(),
             "(for example, it took extra time)"),
    radioButtons(inputId = "it_4d",
                 label = NULL,
                 choices = list("Yes" = 1, 
                                "No" = 2),
                 selected = 2),
    width = "250px")
tags$hr()
h4("5. During the past 4 weeks, have you had any of the following problems with your work or other regular daily activities as a result of any emotional problems (such as feeling depressed or anxious)?")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "5.a. Cut down the amount of time you spent on work or other activities?"),
    radioButtons(inputId = "it_5a",
                 label = NULL,
                 choices = list("Yes" = 1, 
                                "No" = 2),
                 selected = 2),
    width = "250px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "5b. Accomplished less than you would like?"),
    radioButtons(inputId = "it_5b",
                 label = NULL,
                 choices = list("Yes" = 1, 
                                "No" = 2),
                 selected = 2),
    width = "250px")
div(style = "display:inline-block",                            
    tags$div(class = "panel-heading", "5.c. Didn't do work or other activities as carefully as usual"),
    radioButtons(inputId = "it_5c",
                 label = NULL,
                 choices = list("Yes" = 1, 
                                "No" = 2),
                 selected = 2),
    width = "250px")
tags$hr()
div(style = "display:inline-block",
    tags$div(class = "panel-heading", 
             "6. During the past 4 weeks, to what extent has your physical health",
             tags$br(), 
             "or emotional problems interfered with your normal social activities",
             tags$br(),
             "with family, friends, neighbors, or groups?"),
    radioButtons(inputId = "it_6",
                 label = NULL,
                 choices = list("Not at all" = 1, 
                                "Slightly" = 2, 
                                "Moderately" = 3,
                                "Quite a bit" = 4,
                                "Extremely" = 5),
                 selected = 1),
    width = "350px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "7. How much bodily pain have you had during the past 4 weeks?"),
    radioButtons(inputId = "it_7",
                 label = NULL,
                 choices = list("Not at all" = 1, 
                                "Slightly" = 2, 
                                "Moderately" = 3,
                                "Quite a bit" = 4,
                                "Extremely" = 5),
                 selected = 1),
    width = "350px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "8. During the past 4 weeks, how much did pain interfere with your normal work (including both work outside the home and housework)?"),
    radioButtons(inputId = "it_8",
                 label = NULL,
                 choices = list("Not at all" = 1, 
                                "Slightly" = 2, 
                                "Moderately" = 3,
                                "Quite a bit" = 4,
                                "Extremely" = 5),
                 selected = 1),
    width = "350px")
tags$hr()
h4("9. These questions are about how you feel and how things have been with you during the past 4 weeks. For each question, please give the one answer that comes closest to the way you have been feeling. How much of the time during the past 4 weeks.")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "9.a. did you feel full of pep?"),
    radioButtons(inputId = "it_9a",
                 label = NULL,
                 choices = list("Almost all the time" = 1, 
                                "Most of the time" = 2, 
                                "A good bit of the time" = 3,
                                "Some of the time" = 4,
                                "A little bit of the time" = 5,
                                "None of the time" = 6),
                 selected = 1),
    width = "250px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "9.b. have you been a very nervous person?"),
    radioButtons(inputId = "it_9b",
                 label = NULL,
                 choices = list("Almost all the time" = 1, 
                                "Most of the time" = 2, 
                                "A good bit of the time" = 3,
                                "Some of the time" = 4,
                                "A little bit of the time" = 5,
                                "None of the time" = 6),
                 selected = 6),
    width = "250px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "9.c. have you felt so down in the dumps nothing could cheer you up?"),
    radioButtons(inputId = "it_9c",
                 label = NULL,
                 choices = list("Almost all the time" = 1, 
                                "Most of the time" = 2, 
                                "A good bit of the time" = 3,
                                "Some of the time" = 4,
                                "A little bit of the time" = 5,
                                "None of the time" = 6),
                 selected = 6),
    width = "250px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "d. have you felt calm and peaceful?"),
    radioButtons(inputId = "it_9d",
                 label = NULL,
                 choices = list("Almost all the time" = 1, 
                                "Most of the time" = 2, 
                                "A good bit of the time" = 3,
                                "Some of the time" = 4,
                                "A little bit of the time" = 5,
                                "None of the time" = 6),
                 selected = 1),
    width = "250px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "9.e. did you have a lot of energy?"),
    radioButtons(inputId = "it_9e",
                 label = NULL,
                 choices = list("Almost all the time" = 1, 
                                "Most of the time" = 2, 
                                "A good bit of the time" = 3,
                                "Some of the time" = 4,
                                "A little bit of the time" = 5,
                                "None of the time" = 6),
                 selected = 1),
    width = "250px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "9.f. have you felt downhearted and blue?"),
    radioButtons(inputId = "it_9f",
                 label = NULL,
                 choices = list("Almost all the time" = 1, 
                                "Most of the time" = 2, 
                                "A good bit of the time" = 3,
                                "Some of the time" = 4,
                                "A little bit of the time" = 5,
                                "None of the time" = 6),
                 selected = 6),
    width = "250px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "9.g. did you feel worn out?"),
    radioButtons(inputId = "it_9g",
                 label = NULL,
                 choices = list("Almost all the time" = 1, 
                                "Most of the time" = 2, 
                                "A good bit of the time" = 3,
                                "Some of the time" = 4,
                                "A little bit of the time" = 5,
                                "None of the time" = 6),
                 selected = 6),
    width = "250px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "9.h. have you been a happy person?"),
    radioButtons(inputId = "it_9h",
                 label = NULL,
                 choices = list("Almost all the time" = 1, 
                                "Most of the time" = 2, 
                                "A good bit of the time" = 3,
                                "Some of the time" = 4,
                                "A little bit of the time" = 5,
                                "None of the time" = 6),
                 selected = 1),
    width = "250px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "9.i. did you feel tired?"),
    radioButtons(inputId = "it_9i",
             label = NULL,
             choices = list("Almost all the time" = 1, 
                            "Most of the time" = 2, 
                            "A good bit of the time" = 3,
                            "Some of the time" = 4,
                            "A little bit of the time" = 5,
                            "None of the time" = 6),
             selected = 6),
    width = "250px")
tags$hr()
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "10. During the past 4 weeks, how much of the time has your physical health or emotional problems interfered with your social activities (like visiting friends, relatives, etc.)?"),
    radioButtons(inputId = "it_10",
                 label = NULL,
                 choices = list("Almost all the time" = 1, 
                                "Most of the time" = 2,
                                "Some of the time" = 3,
                                "A little bit of the time" = 4,
                                "None of the time" = 5),
                 selected = 5),
    width = "350px")
tags$hr()
h4("How TRUE or FALSE is each of the following statements for you?")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "a. I seem to get sick a little easier than other people"),
    radioButtons(inputId = "it_11a",
                 label = NULL,
                 choices = list("Definitely true" = 1, 
                                "Mostly true" = 2, 
                                "Don't know" = 3,
                                "Moslty false" = 4,
                                "False" = 5),
                selected = 5),
    width = "250px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "b. I am as healthy as anybody I know"),
    radioButtons(inputId = "it_11b",
                 label = NULL,
                 choices = list("Definitely true" = 1, 
                                "Mostly true" = 2, 
                                "Don't know" = 3,
                                "Moslty false" = 4,
                                "False" = 5),
                selected = 1),
    width = "250px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "c. I expect my health to get worse"),
    radioButtons(inputId = "it_11c",
                 label = NULL,
                 choices = list("Definitely true" = 1, 
                                "Mostly true" = 2, 
                                "Don't know" = 3,
                                "Moslty false" = 4,
                                "False" = 5),
                selected = 5),
    width = "250px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "d. My health is excellent"),
    radioButtons(inputId = "it_11d",
                 label = NULL,
                 choices = list("Definitely true" = 1, 
                                "Mostly true" = 2, 
                                "Don't know" = 3,
                                "Moslty false" = 4,
                                "False" = 5),
                selected = 1),
    width = "250px")
tags$hr()
h2("SF-36 results")
plotOutput("SF_36_calc")
tableOutput("SF_36_calc2")
```

A score of 100 indicates no impairment in the specific domain.  
Abreviation of the domains  
BP = Bodily Pain  
GH = General Health  
MH = Mental Health  
PF = Physical Performance  
RE = Role Emotional  
RP = Role Performance  
SF = Social Functioning  
VT = Vitality  

```{r sf-36_shiny_serv, context = "server"}
output$SF_36_calc <- renderPlot({
  
  v_resp_sf36 <- c(as.numeric(as.character(input$it_1)),
                   as.numeric(as.character(input$it_2)),
                   as.numeric(as.character(input$it_3a)), 
                   as.numeric(as.character(input$it_3b)),
                   as.numeric(as.character(input$it_3c)),
                   as.numeric(as.character(input$it_3d)),
                   as.numeric(as.character(input$it_3e)), 
                   as.numeric(as.character(input$it_3f)),
                   as.numeric(as.character(input$it_3g)),
                   as.numeric(as.character(input$it_3h)),
                   as.numeric(as.character(input$it_3i)), 
                   as.numeric(as.character(input$it_3j)),
                   as.numeric(as.character(input$it_4a)),
                   as.numeric(as.character(input$it_4b)),
                   as.numeric(as.character(input$it_4c)), 
                   as.numeric(as.character(input$it_4d)),
                   as.numeric(as.character(input$it_5a)),
                   as.numeric(as.character(input$it_5b)),
                   as.numeric(as.character(input$it_5c)), 
                   as.numeric(as.character(input$it_6)),
                   as.numeric(as.character(input$it_7)),
                   as.numeric(as.character(input$it_8)),
                   as.numeric(as.character(input$it_9a)), 
                   as.numeric(as.character(input$it_9b)),
                   as.numeric(as.character(input$it_9c)),
                   as.numeric(as.character(input$it_9d)),
                   as.numeric(as.character(input$it_9e)), 
                   as.numeric(as.character(input$it_9f)),
                   as.numeric(as.character(input$it_9g)),
                   as.numeric(as.character(input$it_9h)),
                   as.numeric(as.character(input$it_9i)), 
                   as.numeric(as.character(input$it_10)),
                   as.numeric(as.character(input$it_11a)),
                   as.numeric(as.character(input$it_11b)),
                   as.numeric(as.character(input$it_11c)), 
                   as.numeric(as.character(input$it_11d))
                   )
  
  df_plot <- calculate_sf_36(v_resp_sf36)
  
  ggplot(data = df_plot, aes(x = Domain, y = Score, group = Group, color = Group)) +
    geom_line() +
    ylim(0, 100) +
    theme_bw()
}
)

output$SF_36_calc2 <- renderTable({
  
  v_resp_sf36 <- c(as.numeric(as.character(input$it_1)),
                   as.numeric(as.character(input$it_2)),
                   as.numeric(as.character(input$it_3a)), 
                   as.numeric(as.character(input$it_3b)),
                   as.numeric(as.character(input$it_3c)),
                   as.numeric(as.character(input$it_3d)),
                   as.numeric(as.character(input$it_3e)), 
                   as.numeric(as.character(input$it_3f)),
                   as.numeric(as.character(input$it_3g)),
                   as.numeric(as.character(input$it_3h)),
                   as.numeric(as.character(input$it_3i)), 
                   as.numeric(as.character(input$it_3j)),
                   as.numeric(as.character(input$it_4a)),
                   as.numeric(as.character(input$it_4b)),
                   as.numeric(as.character(input$it_4c)), 
                   as.numeric(as.character(input$it_4d)),
                   as.numeric(as.character(input$it_5a)),
                   as.numeric(as.character(input$it_5b)),
                   as.numeric(as.character(input$it_5c)), 
                   as.numeric(as.character(input$it_6)),
                   as.numeric(as.character(input$it_7)),
                   as.numeric(as.character(input$it_8)),
                   as.numeric(as.character(input$it_9a)), 
                   as.numeric(as.character(input$it_9b)),
                   as.numeric(as.character(input$it_9c)),
                   as.numeric(as.character(input$it_9d)),
                   as.numeric(as.character(input$it_9e)), 
                   as.numeric(as.character(input$it_9f)),
                   as.numeric(as.character(input$it_9g)),
                   as.numeric(as.character(input$it_9h)),
                   as.numeric(as.character(input$it_9i)), 
                   as.numeric(as.character(input$it_10)),
                   as.numeric(as.character(input$it_11a)),
                   as.numeric(as.character(input$it_11b)),
                   as.numeric(as.character(input$it_11c)), 
                   as.numeric(as.character(input$it_11d))
  )
  
  df_plot <- calculate_sf_36(v_resp_sf36)
  df_plot
}
)
```

### Questions
```{r open_q_sf36_1}
textInput("sf36_1", "How do you feel about this result? Did you expect to score higher or lower? and why?")
quiz(
  question("Given these results, can you express your quality of life in a single numeric value (i.e. a utility value)?",
           answer("Yes"),
           answer("No", correct = TRUE)
  )
)
textInput("sf36_2", "Explain why (not)")
```

### Answers
The first answer is your own interpretation of these results. Concerning the second, you cannot express the results of teh SF-36 in a utility value. You cannot add your results in the different domains to obtain a utility values for instance. Conversely, the results of the EQ-5D and SF-6D can be expressed in a single numeric value (also called a utility value). This is what we will do in a following assignment using the EQ-5D-5L.  

## QALY calculation
In this assignment you have to calculate the number of QALYs for a patient who is healthy for the first 10 years of her life (Utility (U) = 0.9), has moderate health (U = 0.60) in the next 5 years, and has poor health the last 10 years of her life (U = 0.30).
Fill in the utility values for each period of time in the boxes below, calculate the total number of QALY gained. The graph can help you to do so, i.e. the total number of QALY is equal to the area under the line. and check your answer by clicking the button.  
```{r calc_qaly_shiny}
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "Utility value first 10 years"),
    numericInput(inputId = "util_first_10",
             label = NULL,
             value = 0,
             min = 0,
             max = 1),
    width = "300px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "Utility value next 5 years"),
    numericInput(inputId = "util_5",
             label = NULL,
             value = 0,
             min = 0,
             max = 1),
    width = "300px")
div(style = "display:inline-block",
    tags$div(class = "panel-heading", "Utility value last 10 years"),
    numericInput(inputId = "util_last_10",
             label = NULL,
             value = 0,
             min = 0,
             max = 1),
    width = "300px")
plotOutput("QALY_calc")
numericInput(inputId = "n_QALYs",
             label = "How much QALY does this person accrue over the 25 years? Put your answer",
             value = 0,
             min = 0,
             max = 1)
tags$hr()
actionButton(inputId = "check_QALY_calc",
             label = "Click to check your answer!")
h3(textOutput("TEXT_QALY_calc", container = span))
```

```{r calc_qaly_shiny_serv, context = "server"}
output$QALY_calc <- renderPlot({
  v_u <-  c(rep(as.numeric(as.character(input$util_first_10)), 11),
            rep(as.numeric(as.character(input$util_5)), 6),
            rep(as.numeric(as.character(input$util_last_10)), 11)
            )# vector of utilities
  v_time <- c(c(0:10), 
              c(10:15),
              c(15:25)
              )# vector of time
  plot(x = v_time, y = v_u, type = 'l',
       xlab = "Time (in years)",
       ylab = "Utility value",
       ylim = c(0,1)
       )

}
)

text_button_QALY_calc <- eventReactive(input$check_QALY_calc, {
  if(as.numeric(as.character(input$n_QALYs)) == 15){
    
    paste("Good job, this is correct! 
          The calculation behind this answer is 10 * 0.9 + 5 * 0.6 + 10 * 0.3")
    
  } else {
    paste("This is not the correct answer, try again! Hint: QALYs = quality of life (utility) x length of life")
  }
  
})
  
output$TEXT_QALY_calc <- renderText({
  text_button_QALY_calc()
})
```
